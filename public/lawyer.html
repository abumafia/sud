<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advokatlar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3ZWQTXMJSL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3ZWQTXMJSL');
</script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'teal-gold': {
                            50: '#ecfdf5',
                            500: '#14b8a6',
                            600: '#0d9488',
                            700: '#0f766e'
                        },
                        'gold-accent': '#f59e0b'
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.6s ease-out forwards',
                        'stagger-fade': 'staggerFade 0.3s ease-out forwards',
                        'pulse-slow': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'spin-slow': 'spin 1s linear infinite',
                        'slide-in-right': 'slideInRight 0.5s ease-out forwards'
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        staggerFade: {
                            '0%': { opacity: '0', transform: 'scale(0.95)' },
                            '100%': { opacity: '1', transform: 'scale(1)' }
                        },
                        slideInRight: {
                            '0%': { transform: 'translateX(100%)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .stagger-item:nth-child(1) { animation-delay: 0.1s; }
        .stagger-item:nth-child(2) { animation-delay: 0.2s; }
        .stagger-item:nth-child(3) { animation-delay: 0.3s; }
        .stagger-item:nth-child(4) { animation-delay: 0.4s; }
        .stagger-item:nth-child(5) { animation-delay: 0.5s; }
        .stagger-item:nth-child(6) { animation-delay: 0.6s; }
        .brand-text {
            background: linear-gradient(135deg, #14b8a6, #0d9488);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(20, 184, 166, 0.5);
        }
        .gold-glow {
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
        }
        .avatar-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .avatar-hover:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(20, 184, 166, 0.3);
        }
        .field-focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.2);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-teal-gold-50 to-gray-50">
    <!-- Header -->
    <header class="bg-teal-600 text-white shadow-lg fixed w-full top-0 z-50 transition-all duration-300">
        <nav class="flex justify-between items-center p-4 max-w-7xl mx-auto">
            <div class="nav-brand flex items-center gap-2">
                <div class="w-8 h-8 bg-black rounded-full flex items-center justify-center gold-glow">
                    <span class="text-xs font-bold text-teal-gold-500">H</span>
                </div>
                <h2 class="text-xl md:text-2xl font-bold brand-text">E-Advokatura</h2>
            </div>
            <div class="nav-links hidden md:flex space-x-6">
                <a href="/index" class="hover:text-teal-200 transition-colors px-2 py-1 rounded">Asosiy</a>
                <a href="/lawyer" class="hover:text-teal-200 transition-colors px-2 py-1 rounded bg-teal-700">Advokatlar</a>
                <a href="/chatbot" class="hover:text-teal-200 transition-colors px-2 py-1 rounded">Chatbot</a>
                <a href="/create" class="hover:text-teal-200 transition-colors px-2 py-1 rounded">Post yaratish</a>
                <a href="/profile" class="hover:text-teal-200 transition-colors px-2 py-1 rounded">Profil</a>
                <a href="#" id="logoutBtn" class="bg-gold-accent hover:bg-amber-500 px-4 py-2 rounded transition-colors">Chiqish</a>
            </div>
            <!-- Mobile menu button -->
            <button class="md:hidden text-white" id="mobileMenuBtn">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </nav>
        <!-- Mobile menu -->
        <div id="mobileMenu" class="md:hidden hidden bg-teal-700 px-4 py-2 space-y-2">
            <a href="/index" class="block hover:bg-teal-600 px-3 py-2 rounded">Asosiy</a>
            <a href="/lawyer" class="block hover:bg-teal-600 px-3 py-2 rounded bg-teal-500">Advokatlar</a>
            <a href="/chatbot" class="block hover:bg-teal-600 px-3 py-2 rounded">Chatbot</a>
            <a href="/create" class="block hover:bg-teal-600 px-3 py-2 rounded">Post yaratish</a>
            <a href="/profile" class="block hover:bg-teal-600 px-3 py-2 rounded">Profil</a>
            <a href="#" id="mobileLogout" class="block bg-gold-accent hover:bg-amber-500 px-3 py-2 rounded text-center">Chiqish</a>
        </div>
    </header>

    <!-- Spacer for fixed header -->
    <div class="h-16 md:h-20"></div>

    <main class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header section -->
        <div class="lawyers-header text-center mb-8 animate-fade-in-up">
            <h1 class="text-3xl md:text-4xl font-bold brand-text mb-2">Advokatlar</h1>
            <p class="text-teal-600 text-lg font-semibold">Sizga kerakli mutaxassisni toping va huquqiy masalalarda ishonchli yordam oling</p>
        </div>

        <!-- Search and filters -->
        <div class="search-filters flex flex-col md:flex-row gap-4 mb-8 bg-white p-4 rounded-xl shadow-md gold-glow animate-slide-in-right">
            <input type="text" id="searchLawyers" placeholder="Advokat nomi yoki huquq sohasi bo'yicha qidirish..." 
                   class="flex-1 p-4 border border-teal-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all">
            <select id="legalSpecializationFilter" class="p-4 border border-teal-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all md:w-64">
                <option value="">Barcha huquq sohalari</option>
                <option value="Fuqarolik huquqi">Fuqarolik huquqi</option>
                <option value="Jinoyat huquqi">Jinoyat huquqi</option>
                <option value="Oilaviy huquq">Oilaviy huquq</option>
                <option value="Mehnat huquqi">Mehnat huquqi</option>
                <option value="Soliq huquqi">Soliq huquqi</option>
                <option value="Administrativ huquq">Administrativ huquq</option>
            </select>
            <button onclick="searchLawyers()" class="bg-teal-600 hover:bg-teal-700 text-white px-8 py-4 rounded-xl font-semibold transition-all animate-pulse-slow">
                Qidirish
            </button>
        </div>

        <!-- Loading spinner -->
        <div id="loading" class="hidden text-center py-12">
            <div class="inline-block animate-spin-slow rounded-full h-12 w-12 border-b-2 border-teal-600 mx-auto mb-4"></div>
            <p class="text-teal-600 font-semibold">Advokatlar yuklanmoqda...</p>
        </div>

        <!-- Lawyers grid -->
        <div id="lawyersContainer" class="lawyers-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 space-y-4">
            <!-- Advokatlar ro'yxati stagger animatsiya bilan -->
        </div>
    </main>

    <!-- Maslahat modal -->
    <div id="consultationModal" class="modal fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden p-4">
        <div class="modal-content bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto relative gold-glow">
            <span class="close absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-3xl cursor-pointer z-10 font-bold">&times;</span>
            <div id="consultationForm" class="p-6">
                <!-- Maslahat formasi -->
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let lawyers = [];

        // Mobile menu setup
        function setupMobileMenu() {
            const btn = document.getElementById('mobileMenuBtn');
            const menu = document.getElementById('mobileMenu');
            btn.addEventListener('click', () => {
                menu.classList.toggle('hidden');
            });
        }

        // Loading ko'rsatish/yashirish
        function showLoading(show) {
            document.getElementById('loading').classList.toggle('hidden', !show);
        }

        document.addEventListener('DOMContentLoaded', async () => {
            setupMobileMenu();
            const token = localStorage.getItem('token');
            const userData = localStorage.getItem('user');
            
            if (!token || !userData) {
                window.location.href = '/';
                return;
            }
            
            currentUser = JSON.parse(userData);
            showLoading(true);
            await loadLawyers();
            showLoading(false);
        });

        async function loadLawyers(search = '', legalSpecialization = '') {
            try {
                const token = localStorage.getItem('token');
                let url = '/api/lawyers';
                
                if (search || legalSpecialization) {
                    url += `?search=${encodeURIComponent(search)}&legalSpecialization=${encodeURIComponent(legalSpecialization)}`;
                }
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    lawyers = await response.json();
                    displayLawyers();
                } else {
                    throw new Error('Advokatlarni yuklab bo\'lmadi');
                }
            } catch (error) {
                console.error('Xatolik:', error);
                alert('Advokatlarni yuklab bo\'lmadi');
            }
        }

        function displayLawyers() {
            const container = document.getElementById('lawyersContainer');
            container.innerHTML = '';

            lawyers.forEach((lawyer, index) => {
                const lawyerElement = document.createElement('div');
                lawyerElement.className = 'lawyer-card bg-white rounded-2xl shadow-md overflow-hidden hover:shadow-xl transition-all duration-300 stagger-item animate-stagger-fade opacity-0';
                lawyerElement.style.animationDelay = (index % 6) * 0.1 + 's';
                lawyerElement.innerHTML = `
                    <div class="lawyer-header p-6 bg-gradient-to-r from-teal-50 to-teal-100">
                        <div class="flex items-center gap-4">
                            <img src="${lawyer.profile.avatar || 'default.png'}" 
                                 alt="Avatar" class="avatar w-20 h-20 rounded-full object-cover avatar-hover">
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 mb-1">${lawyer.profile.firstName} ${lawyer.profile.lastName}</h3>
                                <p class="text-teal-600 font-semibold">${lawyer.profile.legalSpecialization}</p>
                                <p class="text-gray-600 flex items-center gap-1"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> ${lawyer.profile.location}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="lawyer-stats p-6 bg-gray-50">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-yellow-500">⭐ ${ (lawyer.profile.rating || 0).toFixed(1) }</span>
                            <span class="text-green-600 font-semibold">✅ ${lawyer.profile.successfulCases || 0} muvaffaqiyatli</span>
                        </div>
                        <div class="flex items-center gap-2 text-sm text-gray-600">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                            ${lawyer.profile.phone || 'Telefon raqami ko\'rsatilmagan'}
                        </div>
                        <div class="flex items-center gap-2 text-sm text-gray-600 mt-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                            ${lawyer.email || 'Email ko\'rsatilmagan'}
                        </div>
                    </div>
                    
                    <div class="lawyer-actions p-6">
                        <button onclick="viewProfile('${lawyer._id}')" class="w-full bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 px-6 rounded-xl font-semibold transition-all mb-2">
                            Profil ko'rish
                        </button>
                        <button onclick="bookConsultation('${lawyer._id}')" class="w-full bg-teal-600 hover:bg-teal-700 text-white py-3 px-6 rounded-xl font-semibold transition-all animate-pulse-slow">
                            Maslahatga yozilish
                        </button>
                    </div>
                `;
                // Animatsiyani boshlash
                setTimeout(() => lawyerElement.classList.remove('opacity-0'), 10);
                container.appendChild(lawyerElement);
            });
        }

        function viewProfile(lawyerId) {
            window.location.href = `/profile?id=${lawyerId}`;
        }

        function bookConsultation(lawyerId) {
            const lawyer = lawyers.find(l => l._id === lawyerId);
            if (!lawyer) return;

            const modal = document.getElementById('consultationModal');
            const form = document.getElementById('consultationForm');
            
            form.innerHTML = `
                <h3 class="text-2xl font-bold text-gray-800 mb-4 brand-text text-center">Maslahatga yozilish</h3>
                <div class="bg-teal-50 p-4 rounded-xl mb-6">
                    <p class="font-semibold text-gray-800 mb-1"><strong>Advokat:</strong> ${lawyer.profile.firstName} ${lawyer.profile.lastName}</p>
                    <p class="text-teal-600 mb-1"><strong>Huquq sohasi:</strong> ${lawyer.profile.legalSpecialization}</p>
                    <p class="text-gray-600"><strong>Reyting:</strong> ⭐ ${(lawyer.profile.rating || 0).toFixed(1)}</p>
                </div>
                
                <form onsubmit="submitConsultation(event, '${lawyerId}')" class="space-y-4">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Sana</label>
                        <input type="date" id="consultationDate" required 
                               min="${new Date().toISOString().split('T')[0]}" 
                               class="w-full p-3 border border-teal-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all">
                    </div>
                    
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Vaqt</label>
                        <select id="consultationTime" required class="w-full p-3 border border-teal-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all">
                            <option value="">Vaqtni tanlang</option>
                            <option value="09:00">09:00</option>
                            <option value="10:00">10:00</option>
                            <option value="11:00">11:00</option>
                            <option value="14:00">14:00</option>
                            <option value="15:00">15:00</option>
                            <option value="16:00">16:00</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Qo'shimcha ma'lumot</label>
                        <textarea id="consultationNotes" rows="4" 
                                  placeholder="Huquqiy masalangiz haqida qisqacha..." 
                                  class="w-full p-3 border border-teal-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all resize-none"></textarea>
                    </div>
                    
                    <button type="submit" class="w-full bg-teal-600 hover:bg-teal-700 text-white py-3 px-6 rounded-xl font-semibold transition-all animate-pulse-slow">
                        Maslahatga yozilish
                    </button>
                </form>
            `;
            
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        async function submitConsultation(event, lawyerId) {
            event.preventDefault();
            
            const date = document.getElementById('consultationDate').value;
            const time = document.getElementById('consultationTime').value;
            const notes = document.getElementById('consultationNotes').value;
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/consultations', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        lawyerId,
                        date,
                        time,
                        notes
                    })
                });
                
                if (response.ok) {
                    alert('Maslahat muvaffaqiyatli yaratildi!');
                    document.getElementById('consultationModal').classList.add('hidden');
                    document.body.style.overflow = 'auto';
                } else {
                    throw new Error('Maslahat yaratishda xatolik');
                }
            } catch (error) {
                console.error('Xatolik:', error);
                alert('Maslahat yaratishda xatolik yuz berdi');
            }
        }

        function searchLawyers() {
            const search = document.getElementById('searchLawyers').value;
            const legalSpecialization = document.getElementById('legalSpecializationFilter').value;
            showLoading(true);
            loadLawyers(search, legalSpecialization);
        }

        // Enter tugmasi bilan qidirish
        document.getElementById('searchLawyers').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchLawyers();
            }
        });

        // Modal yopish
        document.addEventListener('click', (e) => {
            const modal = document.getElementById('consultationModal');
            if (e.target === modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
        });
        document.querySelector('#consultationModal .close').addEventListener('click', () => {
            document.getElementById('consultationModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        });

        // Chiqish
        document.getElementById('logoutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/';
        });
        document.getElementById('mobileLogout').addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/';
        });
    </script>
</body>
</html>
